---
title: ã‚¦ã‚§ãƒ–ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã®ã¿ãªã•ã‚“ï¼ WordPress ã‚’æ¨ã¦ã¦ ä¿å®ˆæ€§ãŒé«˜ãã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚‚å®‰å¿ƒãª Middleman ã§ã‚¦ã‚§ãƒ–ã‚µã‚¤ãƒˆã‚’æ§‹ç¯‰ã—ã‚ˆã†ã‚ˆï¼ ãƒ“ãƒ«ãƒ‰ãŒé€Ÿãã¦ã‚¦ã‚§ãƒ–ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãŒé«˜ããªã‚‹ãï¼
---
# ã‚¦ã‚§ãƒ–ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã®ã¿ãªã•ã‚“ï¼ WordPress ã‚’æ¨ã¦ã¦ ä¿å®ˆæ€§ãŒé«˜ãã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚‚å®‰å¿ƒãª Middleman ã§ã‚¦ã‚§ãƒ–ã‚µã‚¤ãƒˆã‚’æ§‹ç¯‰ã—ã‚ˆã†ã‚ˆï¼ ãƒ“ãƒ«ãƒ‰ãŒé€Ÿãã¦ã‚¦ã‚§ãƒ–ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãŒé«˜ããªã‚‹ãï¼

* Middleman ã¯ãƒ–ãƒ­ã‚°ãªã©ã®é™çš„ãªã‚¦ã‚§ãƒ–ã‚µã‚¤ãƒˆã‚’æ§‹ç¯‰ã™ã‚‹ Ruby ãƒ™ãƒ¼ã‚¹ã®ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚Ruby ã®è¨˜è¿°åŠ›ã‚’ç”Ÿã‹ã—ãŸï¼Œä¿å®ˆæ€§ã®é«˜ã„ã‚¦ã‚§ãƒ–ãƒšãƒ¼ã‚¸ã‚’æ§‹ç¯‰ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ã¾ãŸé™çš„ãªã®ã§ï¼ŒWordPress ã®ã‚ˆã†ãªã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¸Šã®æ”»æ’ƒã‚’å—ã‘ã‚‹ãƒªã‚¹ã‚¯ãŒç›¸å½“è»½æ¸›ã•ã‚Œã¾ã™ã€‚
* Middleman v4 (version 4) ã§ã¯ï¼Œå¤–éƒ¨ãƒ„ãƒ¼ãƒ«ã‚’å‘¼ã³å‡ºã™ External Pipeline ã¨ã„ã†ä»•çµ„ã¿ãŒã‚ã‚Šï¼ŒJavascript ãƒ„ãƒ¼ãƒ«ãªã©ã‚’å‘¼ã³å‡ºã—ã¦ã‚¦ã‚§ãƒ–ãƒšãƒ¼ã‚¸ã‚’ãƒ“ãƒ«ãƒ‰ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
* parcel ã¯æœ€å°é™ã®è¨­å®šã ã‘ã§ï¼Œã¨ã¦ã‚‚ã„ã„æ„Ÿã˜ã‹ã¤é«˜é€Ÿã« HTML/CSS/Javascript ã‚’ãƒ“ãƒ«ãƒ‰ãƒ»ãƒ‘ãƒƒã‚¯ã—ã¦ãã‚Œã‚‹å°ç²‹ãª Javascript ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚
* gulp ã¯ï¼Œãƒ¯ã‚¤ãƒ«ãƒ‰ã‚«ãƒ¼ãƒ‰ã«ã‚ˆã‚‹ãƒ•ã‚¡ã‚¤ãƒ«æŒ‡å®šã¨ï¼Œãƒ•ã‚¡ã‚¤ãƒ«ã®ä¾å­˜é–¢ä¿‚ã‚’è¨­å®šã—ã¦ï¼Œå¤–éƒ¨ãƒ„ãƒ¼ãƒ«ã‚’å‘¼ã³å‡ºã™ã“ã¨ãŒã§ãã‚‹ã‚·ãƒ³ãƒ—ãƒ«ãª Javascript ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚

ãã“ã§éµã¨ãªã‚‹ã®ãŒï¼Œç§ãŒè‡ªä½œã—ãŸ gulp-parcel ã¨ middleman-iepab ã§ã™ã€‚

è¨­å®šãŒæœ€å°é™ã§æ¸ˆã‚€ parcel ã‚’ï¼Œã‚·ãƒ³ãƒ—ãƒ«ã«ãƒ•ã‚¡ã‚¤ãƒ«ã®ä¾å­˜é–¢ä¿‚ã‚’è¨˜è¿°ã§ãã‚‹ gulp ã‹ã‚‰å‘¼ã³å‡ºã™ gulp-parcel ã‚’ä½¿ã†ã¨ï¼Œparcel ã®é«˜ã„æ€§èƒ½ã‚’å¼•ãå‡ºã—ã¤ã¤ï¼Œä»–ã® Javascript ãƒ„ãƒ¼ãƒ«ã¨å”èª¿ã•ã›ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚Middleman ã® External Pipeline ã‹ã‚‰ gulp-parcel ã‚’å«ã‚€ gulp ã®ãƒ„ãƒ¼ãƒ«ãƒã‚§ãƒ¼ãƒ³ã‚’å‘¼ã³å‡ºã—ã¦æ´»ç”¨ã™ã‚‹ã¨ï¼Œãƒ“ãƒ«ãƒ‰ãŒé€Ÿãã¦ã‚¦ã‚§ãƒ–ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã®é«˜ã„ã‚¦ã‚§ãƒ–ã‚µã‚¤ãƒˆã®æ§‹ç¯‰ãŒã§ãã¾ã™ã€‚

ä¸€æ–¹ï¼Œmiddleman-iepab ã¯ãƒ“ãƒ«ãƒ‰å¾Œã« External Pipeline ã‚’å‘¼ã³å‡ºã™ã“ã¨ãŒã§ãã‚‹ã ã‘ã®ã‚·ãƒ³ãƒ—ãƒ«ãªãƒ„ãƒ¼ãƒ«ã§ã™ãŒï¼Œå®Ÿã¯ parcel ã®æ©Ÿèƒ½ã‚’ä½¿ã†ã®ã«æ¬ ã‹ã›ã¾ã›ã‚“ã€‚

æœ¬ç¨¿ã§ã¯ Middleman ã®ãƒ„ãƒ¼ãƒ«ãƒã‚§ãƒ¼ãƒ³ã‚’æ§‹ç¯‰ã™ã‚‹åŸºæœ¬ã¨å¿œç”¨ã«ã¤ã„ã¦ã”ç´¹ä»‹ã—ã¾ã™ã€‚

## å‰ææ¡ä»¶

* Ruby 2.4ç³»ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ¸ˆã§ã‚ã‚‹ã‚‚ã®ã¨ã—ã¾ã™ã€‚(2.3ä»¥å‰ã‚„ï¼Œ2.5ç³»ã¯æœªæ¤œè¨¼)
* Mac ã§ Homebrew ç’°å¢ƒã§ã‚ã‚‹ã‚‚ã®ã¨ã—ã¾ã™ã€‚ãã®ä»–ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ã‚„ Windows ã¯ä½¿ã£ã¦ã„ãªã„ã®ã§ï¼Œæ¤œè¨¼ã—ã¦ãã ã•ã‚‹æ–¹ã‚’æ±‚ã‚ã¾ã™ï¼
* Javascript ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ã¨ã—ã¦ã¯ï¼Œnpm ã§ã¯ãªã yarn ã‚’æ¡ç”¨ã—ã¾ã™ã€‚
* ERB ã‚„ Haml ç­‰ã§ã¯ãªãï¼ŒSlim ã‚’æ¡ç”¨ã—ã¦ã„ã¾ã™ã€‚

## Middleman v4 ã¨ Slim ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```bash
$ gem install middleman slim
```

## Middleman ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®æ–°è¦ä½œæˆ

```bash
$ cd (ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª)
$ middleman init . -T yterajima/middleman-slim
Do you want to use the Asset Pipeline? n
Do you want to use Compass? y
Do you want to use LiveReload? y
Do you want a Rack-compatible config.ru file? y
```

å„é¸æŠè‚¢ã«ã¤ã„ã¦èª¬æ˜ã—ã¾ã™ã€‚

* Asset Pipeline ã¯ï¼ŒMiddleman v3 ä»¥å‰ã§æ¨™æº–ã ã£ãŸæ©Ÿèƒ½ã§ï¼ŒRuby on Rails ã«æº–ã˜ã‚‹ãƒ„ãƒ¼ãƒ«ãƒã‚§ãƒ¼ãƒ³ã‚’æ§‹ç¯‰ã™ã‚‹ãŸã‚ã®ã‚‚ã®ã§ã™ã€‚ä»Šå›ã¯ï¼ŒJavascript ãƒ™ãƒ¼ã‚¹ã®ãƒ„ãƒ¼ãƒ«ãƒã‚§ãƒ¼ãƒ³ã‚’æ§‹ç¯‰ã™ã‚‹ãŸã‚ã®ä»•çµ„ã¿ã§ã‚ã‚‹ External Pipeline ã ã‘ã‚’ç”¨ã„ã‚‹ã®ã§ï¼Œç”¨ã„ã¾ã›ã‚“ã§ã—ãŸã€‚
* Compass ã¯ï¼ŒCSS ã‚’æ§‹é€ åŒ–ã—ã¦æ´»ç”¨ã—ã‚„ã™ãã™ã‚‹ãŸã‚ã®ä»•çµ„ã¿ã§ã™ã€‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ãŠã„ã¦æã¯ãªã„ã§ã—ã‚‡ã†ã€‚
* LiveReload ã¯ï¼Œãƒ­ãƒ¼ã‚«ãƒ«ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’è¡¨ç¤ºã—ãªãŒã‚‰ HTML/CSS/JS ç­‰ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ›´æ–°ã—ãŸæ™‚ã«ï¼Œã‚¦ã‚§ãƒ–ãƒ–ãƒ©ã‚¦ã‚¶ã«è‡ªå‹•ã§ãƒªãƒ­ãƒ¼ãƒ‰ã‚’ã‹ã‘ã¦æœ€æ–°ç‰ˆã‚’è¡¨ç¤ºã—ã¦ãã‚Œã‚‹ã‚ˆã†ã«ã™ã‚‹ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚è¨­å®šã§æœ‰åŠ¹ãƒ»ç„¡åŠ¹ã‚’åˆ‡ã‚Šæ›¿ãˆã‚‰ã‚Œã‚‹ã®ã§ï¼Œã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ãŠã„ã¦æã¯ãªã„ã§ã—ã‚‡ã†ã€‚
* config.ru ã¯ Rack äº’æ›ã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‡ºåŠ›ã™ã‚‹æ©Ÿèƒ½ã§ï¼ŒHeroku ç­‰ã«ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹æ™‚ã«ä½¿ã„ã¾ã™ã€‚

## Javascript ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ã®åˆæœŸåŒ–

```bash
$ yarn init
question name (): 
question version (1.0.0): 
question description: 
question entry point (index.js): 
question repository url (): 
question author (): 
question license (MIT): 
question private: 
```

è‰¯ãã‚ˆã†ã«è¨­å®šã—ã¦ãã ã•ã„ã€‚

* `question name ():` ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåã‚’è¨­å®šã—ã¾ã™ 
* `question version (1.0.0):` åˆæœŸãƒãƒ¼ã‚¸ãƒ§ãƒ³ç•ªå·ã‚’è¨­å®šã—ã¾ã™
* `question description:` ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®èª¬æ˜æ–‡ã‚’è¨­å®šã—ã¾ã™
* `question entry point (index.js):` Javascript ãƒ„ãƒ¼ãƒ«ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã«ã—ãŸæ™‚ã«ï¼Œã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‹ã‚‰æœ€åˆã«å‘¼ã°ã‚Œã‚‹ãƒ—ãƒ­ã‚°ãƒ©ãƒ å(ã‚¨ãƒ³ãƒˆãƒªãƒã‚¤ãƒ³ãƒˆ)ã‚’è¨­å®šã—ã¾ã™ã€‚ä»Šå›ã¯ç‰¹ã«æ„å‘³ãŒã‚ã‚Šã¾ã›ã‚“ã€‚
* `question repository url ():` Git ã®ãƒ¬ãƒã‚¸ãƒˆãƒªã® URL ã‚’è¨­å®šã—ã¾ã™ã€‚ã“ã®ã‚³ãƒãƒ³ãƒ‰ã®å®Ÿè¡Œå‰ã« git ã®è¨­å®šã‚’ã—ã¦ã„ã‚Œã°ï¼Œè‡ªå‹•ã§è¨­å®šã•ã‚Œã¾ã™ã€‚
* `question author ():` è‘—è€…åã¨ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’è¨­å®šã—ã¾ã™ã€‚ã“ã‚“ãªæ„Ÿã˜: `Susumu Yamazaki <hoge@foo.com>`
* `question license (MIT):` ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã‚’è¨­å®šã—ã¾ã™ã€‚å…¬é–‹ã™ã‚‹å ´åˆã¯ã‚ˆãè€ƒãˆã¦é¸ã³ã¾ã—ã‚‡ã†ã€‚
* `question private:` éå…¬é–‹ã«ã™ã‚‹ã‹å…¬é–‹ã™ã‚‹ã‹ã‚’è¨­å®šã—ã¾ã™ã€‚éå…¬é–‹ã«ã—ã¦ãŠãã¨ï¼Œèª¤ã£ã¦ yarn publish ã¨ã‹ã—ãŸæ™‚ã®äº‹æ•…ã‚’é˜²ã’ã¾ã™ã€‚



`.gitignore` ã‚’ç·¨é›†ã—ã¦ãŠãã¾ã—ã‚‡ã†ã€‚ã“ã‚Œã¯ Git ã®ç®¡ç†ä¸‹ã«ç½®ã‹ãªã„ãƒ•ã‚¡ã‚¤ãƒ«ã‚’è¨­å®šã—ã¾ã™ã€‚

```.gitignore
# See http://help.github.com/ignore-files/ for more about ignoring files.
#
# If you find yourself ignoring temporary files generated by your text editor
# or operating system, you probably want to add a global ignore instead:
# git config --global core.excludesfile ~/.gitignore_global

# Ignore bundler config
/.bundle

# Ignore the build directory
/build

# Ignore cache
/.sass-cache
/.cache

# Ignore .DS_store file
.DS_Store

# Ignore yarn log
yarn-error.log

# Ignore yarn.lock
yarn.lock

# Ignore node_modules
/node_modules

# Ignore dist
dist/
```

## ã“ã“ã¾ã§ã®å‹•ä½œç¢ºèª

ãƒ­ãƒ¼ã‚«ãƒ«ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã¯æ¬¡ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å…¥åŠ›ã—ã¾ã™ã€‚

```bash
$ bundle exec middleman serve
``` 

ã‚¦ã‚§ãƒ–ãƒ–ãƒ©ã‚¦ã‚¶ã§ [http://localhost:4567](http://localhost:4567) ã‚’é–‹ãã¨ï¼ŒCSS ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä¼´ã£ãŸ Middleman ã®ãƒ‡ãƒ¢ãƒšãƒ¼ã‚¸ãŒé–²è¦§ã§ãã¾ã™ã€‚

æ¬¡ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å…¥åŠ›ã™ã‚‹ã¨ï¼Œ```build``` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä»¥ä¸‹ã«é™çš„ãƒšãƒ¼ã‚¸ãŒãƒ“ãƒ«ãƒ‰ã•ã‚Œã¾ã™ã€‚

```bash
$ bundle exec middlman build
```

`build` ä»¥ä¸‹ã‚’ã‚¦ã‚§ãƒ–ã‚µã‚¤ãƒˆã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã™ã‚‹(ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹)ã“ã¨ã§ï¼Œæ‰‹è»½ã«é™çš„ã‚¦ã‚§ãƒ–ã‚µã‚¤ãƒˆãŒæ§‹ç¯‰ã§ãã¾ã™ã€‚ã‚ã¨ã§èª¬æ˜ã—ã¾ã™ãŒï¼Œã“ã®ãƒ‡ãƒ—ãƒ­ã‚¤ä½œæ¥­ã‚’1è¡Œã®ã‚³ãƒãƒ³ãƒ‰ã§å®Ÿè¡Œã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹è¨­å®šã‚‚ã§ãã¾ã™ã€‚FTP, ssh + rsync ã®ã»ã‹ï¼ŒGitHub Pages ã«ã‚‚å¯¾å¿œã§ãã¾ã™ã€‚

## parcel ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

ã„ã‚ˆã„ã‚ˆ parcel ã‚’ä½¿ã£ã¦ã¿ã¾ã™ã€‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã¯æ¬¡ã®ã‚ˆã†ã«è¡Œã„ã¾ã™ã€‚

```bash
$ yarn add parcel-bundler
```

## config.rb ã®ä¿®æ­£

parcel ã§ãƒ“ãƒ«ãƒ‰ã§ãã‚‹ã‚ˆã†ã« `config.rb` ã®è¨­å®šã‚’ä¿®æ­£ã—ã¾ã™ã€‚ã‚¢ã‚»ãƒƒãƒˆã¸ã® URL ãŒç›¸å¯¾ãƒ‘ã‚¹ã«ãªã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚

`config.rb` ã® `require 'slim'` ã®å¾Œã«æ¬¡ã®è¡Œã‚’è¿½åŠ ã—ã¾ã™ã€‚ 

```ruby
activate :relative_assets
```
 
## parcel ã«ã‚ˆã‚‹ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼

Middleman ã§ãƒ“ãƒ«ãƒ‰ã—ãŸãƒšãƒ¼ã‚¸ã‚’ parcel ã§ãƒ“ãƒ«ãƒ‰ã—ã¦ãƒ­ãƒ¼ã‚«ãƒ«ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

```bash
$ bundle exec middleman build
$ yarn parcel --no-cache build/index.html
```

ã‚¦ã‚§ãƒ–ãƒ–ãƒ©ã‚¦ã‚¶ã§ [http://localhost:1234](http://localhost:1234) ã‚’é–‹ãã¨ Middleman ã®ãƒ‡ãƒ¢ãƒšãƒ¼ã‚¸ãŒé–²è¦§ã§ãã¾ã™ã€‚

## parcel ã«ã‚ˆã‚‹ãƒ“ãƒ«ãƒ‰

Middleman ã§ãƒ“ãƒ«ãƒ‰ã—ãŸãƒšãƒ¼ã‚¸ã‚’ parcel ã§ã•ã‚‰ã«ãƒ“ãƒ«ãƒ‰ã™ã‚‹ã«ã¯æ¬¡ã®ã‚ˆã†ã«ã—ã¾ã™ã€‚

```bash
$ bundle exec middleman build
$ yarn parcel build build/index.html --out-dir dist --public-url ./
```

`dist` ä»¥ä¸‹ã‚’ã‚¦ã‚§ãƒ–ã‚µã‚¤ãƒˆã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã™ã‚‹(ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹)ã“ã¨ã§ï¼Œæ‰‹è»½ã«é™çš„ã‚¦ã‚§ãƒ–ã‚µã‚¤ãƒˆãŒæ§‹ç¯‰ã§ãã¾ã™ã€‚ã“ã‚Œã‚‚1è¡Œã®ã‚³ãƒãƒ³ãƒ‰ã§å®Ÿè¡Œã§ãã‚‹ã‚ˆã†ã«ã§ãã¾ã™(å¾Œè¿°)ã€‚

## parcel ã§ä½•ã‚’ã—ã¦ã„ã‚‹ã®ã‹ï¼Ÿ

2ã¤ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª `build` ã¨ `dist` ã®ä¸­èº«ã‚’æ¯”ã¹ã¦ã¿ã¾ã—ã‚‡ã†ã€‚æ¬¡ã®ã“ã¨ã«æ°—ã¥ãã¾ã™ã€‚

* CSS ã¨ JS ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¯ `dist` ã§ã¯ãƒ«ãƒ¼ãƒˆã«ãªã£ã¦ã„ã¾ã™ã€‚parcel ã«ã‚ˆã‚Š CSS ã¨ JS ã®å…¨ã¦ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’è‡ªå‹•çš„ã«1ã¤ã«ã¾ã¨ã‚ã¦ãã‚Œã‚‹ã®ã§ï¼Œãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«åˆ†ã‘ã‚‹å¿…è¦ã¯ãªã„ã¨ã„ã†åˆ¤æ–­ã§ã—ã‚‡ã†ã€‚
* ã¨ãã«ä½•ã‚‚è¨­å®šã—ãªãã¦ã‚‚ï¼ŒCSS ã¨ JS ã‚„ç”»åƒã®ãƒ•ã‚¡ã‚¤ãƒ«åãŒ `dist` ã§ã¯ãƒãƒƒã‚·ãƒ¥åŒ–ã•ã‚ŒãŸåå‰ã«ãªã£ã¦ã„ã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šï¼Œæ›´æ–°ã•ã‚ŒãŸæ™‚ã«ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã•ã‚Œã‚‹ã“ã¨ã‚’å›é¿ã—ã¦ãã‚Œã¾ã™ã€‚
* CSS ã¨ JS ã®ã‚³ãƒ¼ãƒ‰ã‚’èª­ã‚“ã§ã¿ã‚‹ã¨ï¼Œ `dist` ã§ã¯è‡ªå‹•çš„ã«æœ€å°åŒ–ã—ã¦ãã‚Œã¦ã„ã¾ã™ã€‚ã“ã‚Œã‚’æŠ‘åˆ¶ã™ã‚‹ã«ã¯ parcel ã« `--no-minify` ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ã¤ã‘ã¾ã™ã€‚

## Middleman ã‹ã‚‰ parcel ã‚’ãƒ“ãƒ«ãƒ‰ã—ã‚ˆã†

ãƒ“ãƒ«ãƒ‰ã™ã‚‹ãŸã³ã«2å›ã‚³ãƒãƒ³ãƒ‰ã‚’æ‰“ã¡è¾¼ã‚€ã®ã¯é¢å€’ã§ã™ã­ã€‚ãã“ã§ï¼ŒMiddleman ã® External Pipeline ã‚’ä½¿ã£ã¦ parcel ã‚’å‘¼ã³å‡ºã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

Middleman ã®ãƒãƒ‹ãƒ¥ã‚¢ãƒ«é€šã‚Šã« External Pipeline ã‚’ä½¿ã†ã¨ï¼Œ`config.rb` ã® `# Build-specific configuration` ã®ç›´å¾Œã‚’æ¬¡ã®ã‚ˆã†ã«ã—ã¾ã™ã€‚

```ruby
# Build-specific configuration
configure :build do
  # Minify CSS on build
  # activate :minify_css

  # Minify Javascript on build
  # activate :minify_javascript

  activate :external_pipeline,
  name: :parcel,
    command: "yarn parcel build build/index.html --out-dir dist --public-url ./", 
    source: "build",
    latency: 1
end
```

ã“ã®ã‚ã¨ï¼Œæ¬¡ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å…¥åŠ›ã—ã¦ Middleman ã®ãƒ“ãƒ«ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

```bash
$ bundle exec middleman build
```

ã™ã‚‹ã¨ï¼Œä¸€è¦‹æ­£ã—ãå®Ÿè¡Œã§ãã‚‹ã‚ˆã†ã«è¦‹ãˆã¾ã™ã€‚

```bash
$ bundle exec middleman build
== Executing: `yarn parcel build build/index.html --out-dir dist --public-url ./`
== External: yarn run v1.3.2
== External: $ .../node_modules/.bin/parcel build build/index.html --out-dir dist --public-url ./
== External: â³  Building...
== External: â³  Building index.html...
== External: â³  Building site.css...
== External: â³  Building all.js...
== External: â³  Building middleman-logo.svg...
== External: â³  Building jquery.js...
== External: â³  Building browser.js...
== External: âœ¨  Built in 1.80s.
== External: Done in 3.23s.
   identical  build/stylesheets/site.css
   identical  build/stylesheets/site.css
   identical  build/images/middleman-logo.svg
   identical  build/javascripts/all.js
   identical  build/index.html
   identical  build/index.html
Project built successfully.
```

ã§ã‚‚ã‚ˆãè¦‹ã‚‹ã¨å…ˆã« parcel ã‚’å®Ÿè¡Œã—ãŸå¾Œï¼ŒMiddleman ãŒãƒ“ãƒ«ãƒ‰ã—ã¦ã„ã¾ã™ã­ã€‚è©¦ã—ã«ä¸‹è¨˜ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ `build` ã¨ `dist` ã‚’æ¶ˆã—ã¦ã‹ã‚‰ãƒ“ãƒ«ãƒ‰ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

```bash
$ rm -rf build dist
$ bundle exec middleman build
```

ä»Šåº¦ã¯ä¸‹è¨˜ã®ã‚ˆã†ã«ã‚¨ãƒ©ãƒ¼ã§æ­¢ã¾ã£ã¦ã—ã¾ã„ã¾ã™ã€‚

```bash
$ rm -rf build dist
$ bundle exec middleman build
== Executing: `yarn parcel build build/index.html --out-dir dist --public-url ./`
== External: yarn run v1.3.2
== External: $ .../node_modules/.bin/parcel build build/index.html --out-dir dist --public-url ./
== External: â³  Building...
== External: ğŸš¨  Cannot find module '.../build/index.html' from '.'
...
error Command failed with exit code 1.                                         
== External: info Visit https://yarnpkg.com/en/docs/cli/run for documentation about this command.
== External: Command failed with non-zero exit status
```

External Pipeline ã®å®Ÿè¡Œã¨ Middleman ã®ãƒ“ãƒ«ãƒ‰ã®å®Ÿè¡Œã®é †ç•ªã‚’å…¥ã‚Œæ›¿ãˆãŸã„ã§ã™ã­ã€‚ã§ã‚‚ï¼ŒMiddleman ã®æ¨™æº–æ©Ÿèƒ½ã§ã¯å®Ÿç¾ã§ãã¾ã›ã‚“ã€‚

## middleman-iepab ã®å°å…¥

ãã“ã§ï¼Œç§ã¯ Middleman ã®ãƒ“ãƒ«ãƒ‰ã®å¾Œã« External Pipeline ã®å®Ÿè¡Œã‚’ã™ã‚‹ã‚«ã‚¹ã‚¿ãƒ æ‹¡å¼µ middleman-iepab ã‚’é–‹ç™ºã—ã¾ã—ãŸã€‚ã¡ãªã¿ã« iepab ã¨ã„ã†ã®ã¯ Invoke External Pipeline after Buidliing ã®ç•¥ã§ã™ã€‚æ©Ÿèƒ½ãã®ã¾ã‚“ã¾ã§ã™ã­ã€‚

ã¾ãšï¼Œ`Gemfile` ã®æœ«å°¾ã«æ¬¡ã®è¨˜è¿°ã‚’è¿½åŠ ã—ã¾ã—ã‚‡ã†ã€‚

```Gemfile
gem 'middleman-iepab', '>= 0.1.1'
```

ãã®å¾Œï¼Œæ¬¡ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¾ã™(ã‚«ã‚¹ã‚¿ãƒ æ‹¡å¼µã‚’è¿½åŠ ã™ã‚‹ãªã© `Gemfile` ã‚’å¤‰æ›´ã—ãŸå ´åˆã¯å¿…ãšå®Ÿè¡Œã—ã¾ã™)ã€‚

```bash
$ bundle install
```

ã‚¨ãƒ©ãƒ¼ãŒãªãå®Œäº†ã—ãŸã“ã¨ã‚’ç¢ºèªã—ï¼Œ`config.rb` ã®å…ˆã»ã©ã®è¨˜è¿°ã‚’æ¬¡ã®ã‚ˆã†ã«å¤‰æ›´ã—ã¾ã™ã€‚

```ruby
# Build-specific configuration
configure :build do
  # Minify CSS on build
  # activate :minify_css

  # Minify Javascript on build
  # activate :minify_javascript

  activate :iepab,
  name: :parcel,
    command: "yarn parcel build build/index.html --out-dir dist --public-url ./", 
    source: "build",
    latency: 1
end
```

ãã®å¾Œï¼ŒãŠã‚‚ã‚€ã‚ã« Middleman ã®ãƒ“ãƒ«ãƒ‰ã‚’å®Ÿè¡Œã—ã¾ã—ã‚‡ã†ã€‚

```bash
$ bundle exec middleman build
```

ä»Šåº¦ã¯æ¬¡ã®ã‚ˆã†ã«æ­£å¸¸ã«å®Ÿè¡Œã§ãã¾ã™ï¼

```bash
$ bundle exec middleman build
      create  build/stylesheets/site.css
      create  build/images/middleman-logo.svg
      create  build/javascripts/all.js
      create  build/index.html
== Executing: `yarn parcel build build/index.html --out-dir dist --public-url ./`
== External: yarn run v1.3.2
warning package.json: No license field                                         
== External: $ .../node_modules/.bin/parcel build build/index.html --out-dir dist --public-url ./
== External: â³  Building...
== External: â³  Building index.html...
== External: â³  Building site.css...
== External: â³  Building all.js...
== External: â³  Building middleman-logo.svg...
== External: â³  Building jquery.js...
== External: â³  Building browser.js...
== External: âœ¨  Built in 1.53s.
== External: Done in 2.22s.
Project built successfully.
```

ãªãŠï¼Œç¾çŠ¶ã® middlman-iepab ã¯ watch ãƒ¢ãƒ¼ãƒ‰ (`middleman serve`) ã«å¯¾å¿œã§ãã¦ã„ã¾ã›ã‚“ã€‚ç¾åœ¨ï¼Œå¯¾å¿œã§ãã‚‹ã‚ˆã†ã«èª¿æŸ»ã‚’ã—ã¦ã„ã‚‹ã¨ã“ã‚ã§ã™ã€‚

## è¤‡æ•°ãƒšãƒ¼ã‚¸ã®ãƒ“ãƒ«ãƒ‰

æ¬¡ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å…¥åŠ›ã—ã¦è¤‡æ•°ãƒšãƒ¼ã‚¸ãŒã‚ã‚‹çŠ¶æ…‹ã«ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

```bash
$ cp source/index.html.slim source/index2.html.slim
$ mkdir source/about
$ cp source/index.html.slim source/about/index.html.slim
```

ã“ã‚Œã‚‰ã‚’ãƒ“ãƒ«ãƒ‰ã—ã‚ˆã†ã¨æ€ã£ã¦ã‚‚1ã¤ã® html ãƒ•ã‚¡ã‚¤ãƒ«ã—ã‹ parcel ã§ãƒ“ãƒ«ãƒ‰ã•ã‚Œã¾ã›ã‚“ã€‚

```bash
$ bundle exec middleman build
      create  build/stylesheets/site.css
      create  build/javascripts/all.js
      create  build/images/middleman-logo.svg
      create  build/index.html
      create  build/index2.html
      create  build/about/index.html
== Executing: `yarn parcel build build/index.html --out-dir dist --public-url ./`
== External: yarn run v1.3.2
warning package.json: No license field                                         
== External: $ .../node_modules/.bin/parcel build build/index.html --out-dir dist --public-url ./
== External: â³  Building...
== External: â³  Building index.html...
== External: â³  Building site.css...
== External: â³  Building all.js...
== External: â³  Building middleman-logo.svg...
== External: â³  Building jquery.js...
== External: â³  Building browser.js...
== External: âœ¨  Built in 1.53s.
== External: Done in 2.19s.
Project built successfully.
$ ls dist/
815aa32b3c46be9eaeee563dc5303036.css  da24f1e92e1197f7cdfcda9996f918d4.js
d5b2b1aa06bfb67190f67a5ce4370081.svg  index.html
```

ãã“ã§ç§ãŒé–‹ç™ºã—ãŸã®ãŒ gulp-parcel ã§ã™ã€‚gulp-parcel ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã«ã¯æ¬¡ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚

```bash
$ yarn add gulp gulp-coffee gulp-parcel
```

æ¬¡ã®ã‚ˆã†ã« gulpfile.coffee ã‚’ä½œæˆã—ã¾ã™ã€‚

```coffee
gulp = require 'gulp'
parcel = require 'gulp-parcel'

gulp.task 'build', () ->
  gulp.src 'build/**/*.html', {read:false}
    .pipe parcel({outDir: 'dist', publicURL: './'}, {source: 'build'})
    .pipe gulp.dest('dist')
```

ãã—ã¦ `config.rb` ã®å…ˆã»ã©ã®è¨˜è¿°ã‚’æ¬¡ã®ã‚ˆã†ã«å¤‰æ›´ã—ã¾ã™ã€‚

```ruby
# Build-specific configuration
configure :build do
  # Minify CSS on build
  # activate :minify_css

  # Minify Javascript on build
  # activate :minify_javascript

  activate :iepab,
  name: :gulp,
    command: "yarn gulp build", 
    source: "build",
    latency: 1
end
```

ã§ã¯ãƒ“ãƒ«ãƒ‰ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

```bash
$ bundle exec middleman build
   identical  build/stylesheets/site.css
   identical  build/images/middleman-logo.svg
   identical  build/javascripts/all.js
   identical  build/about/index.html
   identical  build/index.html
   identical  build/index2.html
== Executing: `yarn gulp build`
== External: yarn run v1.3.2
warning package.json: No license field                                         
== External: $ .../node_modules/.bin/gulp build
== External: [20:12:34] Requiring external module coffeescript/register
== External: [20:12:35] Using gulpfile ~/github/enPiT-everi/gulpfile.coffee
== External: [20:12:35] Starting 'build'...
== External: â³  Building...
== External: â³  Building index.html...
== External: â³  Building site.css...
== External: â³  Building all.js...
== External: â³  Building middleman-logo.svg...
== External: â³  Building jquery.js...
== External: â³  Building browser.js...
== External: âœ¨  Built in 903ms.
== External: â³  Building...
== External: â³  Building index2.html...
== External: â³  Building site.css...
== External: â³  Building all.js...
== External: â³  Building middleman-logo.svg...
== External: â³  Building jquery.js...
== External: â³  Building browser.js...
== External: âœ¨  Built in 95ms.
== External: â³  Building...
== External: â³  Building index.html...
== External: â³  Building site.css...
== External: â³  Building all.js...
== External: â³  Building middleman-logo.svg...
== External: â³  Building jquery.js...
== External: â³  Building browser.js...
== External: âœ¨  Built in 142ms.
== External: [20:12:36] Finished 'build' after 1.18 s
== External: Done in 2.61s.
Project built successfully.
```

â€» åŒã˜ css, js, ç”»åƒ ãŒ3å›ã‚‚ãƒ“ãƒ«ãƒ‰ã•ã‚Œã¦ã„ã‚‹ç‚¹ãŒï¼Œã¾ã ã¾ã æœ€é©åŒ–ã®ä½™åœ°ãŒã‚ã‚Šã¾ã™ã­ã€‚

ã“ã‚Œã«ã‚ˆã‚Š 3ã¤ã® html ãƒ•ã‚¡ã‚¤ãƒ«ãŒãƒ“ãƒ«ãƒ‰ã•ã‚Œã¦ã„ã¾ã™ã€‚

```bash
$ ls -R dist
815aa32b3c46be9eaeee563dc5303036.css  da24f1e92e1197f7cdfcda9996f918d4.js
about         index.html
d5b2b1aa06bfb67190f67a5ce4370081.svg  index2.html

dist/about:
815aa32b3c46be9eaeee563dc5303036.css  da24f1e92e1197f7cdfcda9996f918d4.js
d5b2b1aa06bfb67190f67a5ce4370081.svg  index.html
```

â€» `dist/about` ã«ã‚‚ css, js, ç”»åƒ ãŒé…ç½®ã•ã‚Œã¦ã„ã‚‹ç‚¹ãŒï¼Œã¾ã ã¾ã æ”¹å–„ã®ä½™åœ°ãŒã‚ã‚Šã¾ã™ã­ã€‚

## Javascript ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ã£ã¦ã¿ã‚ˆã†: jQuery ã®å ´åˆ

